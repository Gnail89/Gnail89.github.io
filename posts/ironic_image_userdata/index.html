<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ironic image and userdata | ğŸ“•W.'s Blog</title>
<meta name=keywords content="ironic"><meta name=description content="è£¸é‡‘å±é•œåƒé…ç½® é•œåƒåˆ¶ä½œ type: whole disk image
å‡†å¤‡ ç³»ç»Ÿé•œåƒISO
UEFI å¼•å¯¼
qemu-kvmç¯å¢ƒ
å‘½åè§„èŒƒ åŒºåŸŸ-ç‰ˆæœ¬-æ¶æ„-å¯åŠ¨ç±»å‹-æ–‡ä»¶ç³»ç»Ÿ-é•œåƒå¤§å°: C01-AnolisOS-8.8-x86_64-UEFI-XFS-LVM-8G-IRONIC-yyymmdd.qcow2
åˆ†åŒºè§„åˆ’å‚è€ƒ é•œåƒå¤§å°8GB, å¯æŒ‰éœ€æ±‚è¿›è¡Œåˆ†åŒº, åé¢é…åˆuserdataä½¿ç”¨
FS VG LV SIZE /boot - - 1 GB /boot/efi - - 600 MB / rootvg root 1 GB /usr rootvg usr 4 GB /var rootvg var 1 GB /home rootvg home 1 GB è½¯ä»¶å®‰è£… cloud-init
qemu-guest-agent (å¯é€‰)
dnf install -y cloud-init qemu-guest-agent cloud-inité…ç½®æ–‡ä»¶æ›´æ–° # æ›´æ–°çš„å†…å®¹ no_ssh_fingerprints: true disable_root: false ssh_pwauth: true network: config: disabled datasource_list: [OpenStack, ConfigDrive] datasource: OpenStack: metadata_urls: ['http://169."><meta name=author content><link rel=canonical href=https://gnail89.github.io/posts/ironic_image_userdata/><link crossorigin=anonymous href=/assets/css/stylesheet.6a98292fb8fa8cf0f3ba4042d4b75515c04267550f3ad49ff6271b5af9562443.css integrity="sha256-apgpL7j6jPDzukBC1LdVFcBCZ1UPOtSf9icbWvlWJEM=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://gnail89.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://gnail89.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://gnail89.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://gnail89.github.io/apple-touch-icon.png><link rel=mask-icon href=https://gnail89.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://gnail89.github.io/posts/ironic_image_userdata/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="ironic image and userdata"><meta property="og:description" content="è£¸é‡‘å±é•œåƒé…ç½® é•œåƒåˆ¶ä½œ type: whole disk image
å‡†å¤‡ ç³»ç»Ÿé•œåƒISO
UEFI å¼•å¯¼
qemu-kvmç¯å¢ƒ
å‘½åè§„èŒƒ åŒºåŸŸ-ç‰ˆæœ¬-æ¶æ„-å¯åŠ¨ç±»å‹-æ–‡ä»¶ç³»ç»Ÿ-é•œåƒå¤§å°: C01-AnolisOS-8.8-x86_64-UEFI-XFS-LVM-8G-IRONIC-yyymmdd.qcow2
åˆ†åŒºè§„åˆ’å‚è€ƒ é•œåƒå¤§å°8GB, å¯æŒ‰éœ€æ±‚è¿›è¡Œåˆ†åŒº, åé¢é…åˆuserdataä½¿ç”¨
FS VG LV SIZE /boot - - 1 GB /boot/efi - - 600 MB / rootvg root 1 GB /usr rootvg usr 4 GB /var rootvg var 1 GB /home rootvg home 1 GB è½¯ä»¶å®‰è£… cloud-init
qemu-guest-agent (å¯é€‰)
dnf install -y cloud-init qemu-guest-agent cloud-inité…ç½®æ–‡ä»¶æ›´æ–° # æ›´æ–°çš„å†…å®¹ no_ssh_fingerprints: true disable_root: false ssh_pwauth: true network: config: disabled datasource_list: [OpenStack, ConfigDrive] datasource: OpenStack: metadata_urls: ['http://169."><meta property="og:type" content="article"><meta property="og:url" content="https://gnail89.github.io/posts/ironic_image_userdata/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-12-18T00:00:00+08:00"><meta property="article:modified_time" content="2023-12-18T00:00:00+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="ironic image and userdata"><meta name=twitter:description content="è£¸é‡‘å±é•œåƒé…ç½® é•œåƒåˆ¶ä½œ type: whole disk image
å‡†å¤‡ ç³»ç»Ÿé•œåƒISO
UEFI å¼•å¯¼
qemu-kvmç¯å¢ƒ
å‘½åè§„èŒƒ åŒºåŸŸ-ç‰ˆæœ¬-æ¶æ„-å¯åŠ¨ç±»å‹-æ–‡ä»¶ç³»ç»Ÿ-é•œåƒå¤§å°: C01-AnolisOS-8.8-x86_64-UEFI-XFS-LVM-8G-IRONIC-yyymmdd.qcow2
åˆ†åŒºè§„åˆ’å‚è€ƒ é•œåƒå¤§å°8GB, å¯æŒ‰éœ€æ±‚è¿›è¡Œåˆ†åŒº, åé¢é…åˆuserdataä½¿ç”¨
FS VG LV SIZE /boot - - 1 GB /boot/efi - - 600 MB / rootvg root 1 GB /usr rootvg usr 4 GB /var rootvg var 1 GB /home rootvg home 1 GB è½¯ä»¶å®‰è£… cloud-init
qemu-guest-agent (å¯é€‰)
dnf install -y cloud-init qemu-guest-agent cloud-inité…ç½®æ–‡ä»¶æ›´æ–° # æ›´æ–°çš„å†…å®¹ no_ssh_fingerprints: true disable_root: false ssh_pwauth: true network: config: disabled datasource_list: [OpenStack, ConfigDrive] datasource: OpenStack: metadata_urls: ['http://169."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://gnail89.github.io/posts/"},{"@type":"ListItem","position":2,"name":"ironic image and userdata","item":"https://gnail89.github.io/posts/ironic_image_userdata/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ironic image and userdata","name":"ironic image and userdata","description":"è£¸é‡‘å±é•œåƒé…ç½® é•œåƒåˆ¶ä½œ type: whole disk image\nå‡†å¤‡ ç³»ç»Ÿé•œåƒISO\nUEFI å¼•å¯¼\nqemu-kvmç¯å¢ƒ\nå‘½åè§„èŒƒ åŒºåŸŸ-ç‰ˆæœ¬-æ¶æ„-å¯åŠ¨ç±»å‹-æ–‡ä»¶ç³»ç»Ÿ-é•œåƒå¤§å°: C01-AnolisOS-8.8-x86_64-UEFI-XFS-LVM-8G-IRONIC-yyymmdd.qcow2\nåˆ†åŒºè§„åˆ’å‚è€ƒ é•œåƒå¤§å°8GB, å¯æŒ‰éœ€æ±‚è¿›è¡Œåˆ†åŒº, åé¢é…åˆuserdataä½¿ç”¨\nFS VG LV SIZE /boot - - 1 GB /boot/efi - - 600 MB / rootvg root 1 GB /usr rootvg usr 4 GB /var rootvg var 1 GB /home rootvg home 1 GB è½¯ä»¶å®‰è£… cloud-init\nqemu-guest-agent (å¯é€‰)\ndnf install -y cloud-init qemu-guest-agent cloud-inité…ç½®æ–‡ä»¶æ›´æ–° # æ›´æ–°çš„å†…å®¹ no_ssh_fingerprints: true disable_root: false ssh_pwauth: true network: config: disabled datasource_list: [OpenStack, ConfigDrive] datasource: OpenStack: metadata_urls: [\u0026#39;http://169.","keywords":["ironic"],"articleBody":"è£¸é‡‘å±é•œåƒé…ç½® é•œåƒåˆ¶ä½œ type: whole disk image\nå‡†å¤‡ ç³»ç»Ÿé•œåƒISO\nUEFI å¼•å¯¼\nqemu-kvmç¯å¢ƒ\nå‘½åè§„èŒƒ åŒºåŸŸ-ç‰ˆæœ¬-æ¶æ„-å¯åŠ¨ç±»å‹-æ–‡ä»¶ç³»ç»Ÿ-é•œåƒå¤§å°: C01-AnolisOS-8.8-x86_64-UEFI-XFS-LVM-8G-IRONIC-yyymmdd.qcow2\nåˆ†åŒºè§„åˆ’å‚è€ƒ é•œåƒå¤§å°8GB, å¯æŒ‰éœ€æ±‚è¿›è¡Œåˆ†åŒº, åé¢é…åˆuserdataä½¿ç”¨\nFS VG LV SIZE /boot - - 1 GB /boot/efi - - 600 MB / rootvg root 1 GB /usr rootvg usr 4 GB /var rootvg var 1 GB /home rootvg home 1 GB è½¯ä»¶å®‰è£… cloud-init\nqemu-guest-agent (å¯é€‰)\ndnf install -y cloud-init qemu-guest-agent cloud-inité…ç½®æ–‡ä»¶æ›´æ–° # æ›´æ–°çš„å†…å®¹ no_ssh_fingerprints: true disable_root: false ssh_pwauth: true network: config: disabled datasource_list: [OpenStack, ConfigDrive] datasource: OpenStack: metadata_urls: ['http://169.254.169.254'] max_wait: 120 timeout: 5 # ç¤ºä¾‹ sed -i '/# from the distro configuration/a\\no_ssh_fingerprints: true' /etc/cloud/cloud.cfg sed -i '/disable_root: false/a\\ssh_pwauth: 1' /etc/cloud/cloud.cfg echo ' network: config: disabled' \u003e\u003e /etc/cloud/cloud.cfg echo \" datasource_list: [OpenStack, ConfigDrive] datasource: OpenStack: metadata_urls: ['http://169.254.169.254'] max_wait: 120 timeout: 5\" \u003e\u003e /etc/cloud/cloud.cfg # å¼€æœºè‡ªå¯åŠ¨ systemctl enable cloud-init-local.service cloud-init.service cloud-config.service cloud-final.service æ·»åŠ raidé©±åŠ¨ cat \u003e /etc/dracut.conf.d/raid_drives.conf \u003c","wordCount":"650","inLanguage":"en","datePublished":"2023-12-18T00:00:00+08:00","dateModified":"2023-12-18T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://gnail89.github.io/posts/ironic_image_userdata/"},"publisher":{"@type":"Organization","name":"ğŸ“•W.'s Blog","logo":{"@type":"ImageObject","url":"https://gnail89.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://gnail89.github.io/ accesskey=h title="ğŸ“•W.'s Blog (Alt + H)">ğŸ“•W.'s Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://gnail89.github.io/search/ title=ğŸ”Search><span>ğŸ”Search</span></a></li><li><a href=https://gnail89.github.io/archives/ title=ğŸ“šArchive><span>ğŸ“šArchive</span></a></li><li><a href=https://gnail89.github.io/tags/ title=ğŸ”–Tags><span>ğŸ”–Tags</span></a></li><li><a href=https://gnail89.github.io/categories/ title=ğŸ§©Categories><span>ğŸ§©Categories</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://gnail89.github.io/>Home</a>&nbsp;Â»&nbsp;<a href=https://gnail89.github.io/posts/>Posts</a></div><h1 class=post-title>ironic image and userdata</h1></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e8%a3%b8%e9%87%91%e5%b1%9e%e9%95%9c%e5%83%8f%e9%85%8d%e7%bd%ae aria-label=è£¸é‡‘å±é•œåƒé…ç½®>è£¸é‡‘å±é•œåƒé…ç½®</a><ul><li><a href=#%e9%95%9c%e5%83%8f%e5%88%b6%e4%bd%9c aria-label=é•œåƒåˆ¶ä½œ>é•œåƒåˆ¶ä½œ</a><ul><li><a href=#%e5%87%86%e5%a4%87 aria-label=å‡†å¤‡>å‡†å¤‡</a></li><li><a href=#%e5%91%bd%e5%90%8d%e8%a7%84%e8%8c%83 aria-label=å‘½åè§„èŒƒ>å‘½åè§„èŒƒ</a></li><li><a href=#%e5%88%86%e5%8c%ba%e8%a7%84%e5%88%92%e5%8f%82%e8%80%83 aria-label=åˆ†åŒºè§„åˆ’å‚è€ƒ>åˆ†åŒºè§„åˆ’å‚è€ƒ</a></li><li><a href=#%e8%bd%af%e4%bb%b6%e5%ae%89%e8%a3%85 aria-label=è½¯ä»¶å®‰è£…>è½¯ä»¶å®‰è£…</a></li><li><a href=#cloud-init%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e6%9b%b4%e6%96%b0 aria-label=cloud-inité…ç½®æ–‡ä»¶æ›´æ–°>cloud-inité…ç½®æ–‡ä»¶æ›´æ–°</a></li><li><a href=#%e6%b7%bb%e5%8a%a0raid%e9%a9%b1%e5%8a%a8 aria-label=æ·»åŠ raidé©±åŠ¨>æ·»åŠ raidé©±åŠ¨</a></li></ul></li><li><a href=#userdata%e6%a8%a1%e6%9d%bf aria-label=UserDataæ¨¡æ¿>UserDataæ¨¡æ¿</a></li><li><a href=#ironic-node%e6%8e%a8%e9%80%81%e7%a4%ba%e4%be%8b aria-label="ironic nodeæ¨é€ç¤ºä¾‹">ironic nodeæ¨é€ç¤ºä¾‹</a></li></ul></li></ul></div></details></div><div class=post-content><h1 id=è£¸é‡‘å±é•œåƒé…ç½®>è£¸é‡‘å±é•œåƒé…ç½®<a hidden class=anchor aria-hidden=true href=#è£¸é‡‘å±é•œåƒé…ç½®>#</a></h1><h2 id=é•œåƒåˆ¶ä½œ>é•œåƒåˆ¶ä½œ<a hidden class=anchor aria-hidden=true href=#é•œåƒåˆ¶ä½œ>#</a></h2><blockquote><p>type: whole disk image</p></blockquote><h3 id=å‡†å¤‡>å‡†å¤‡<a hidden class=anchor aria-hidden=true href=#å‡†å¤‡>#</a></h3><ul><li><p>ç³»ç»Ÿé•œåƒISO</p></li><li><p>UEFI å¼•å¯¼</p></li><li><p>qemu-kvmç¯å¢ƒ</p></li></ul><h3 id=å‘½åè§„èŒƒ>å‘½åè§„èŒƒ<a hidden class=anchor aria-hidden=true href=#å‘½åè§„èŒƒ>#</a></h3><blockquote><p>åŒºåŸŸ-ç‰ˆæœ¬-æ¶æ„-å¯åŠ¨ç±»å‹-æ–‡ä»¶ç³»ç»Ÿ-é•œåƒå¤§å°:
C01-AnolisOS-8.8-x86_64-UEFI-XFS-LVM-8G-IRONIC-yyymmdd.qcow2</p></blockquote><h3 id=åˆ†åŒºè§„åˆ’å‚è€ƒ>åˆ†åŒºè§„åˆ’å‚è€ƒ<a hidden class=anchor aria-hidden=true href=#åˆ†åŒºè§„åˆ’å‚è€ƒ>#</a></h3><blockquote><p>é•œåƒå¤§å°8GB, å¯æŒ‰éœ€æ±‚è¿›è¡Œåˆ†åŒº, åé¢é…åˆuserdataä½¿ç”¨</p></blockquote><table><thead><tr><th>FS</th><th>VG</th><th>LV</th><th>SIZE</th></tr></thead><tbody><tr><td>/boot</td><td>-</td><td>-</td><td>1 GB</td></tr><tr><td>/boot/efi</td><td>-</td><td>-</td><td>600 MB</td></tr><tr><td>/</td><td>rootvg</td><td>root</td><td>1 GB</td></tr><tr><td>/usr</td><td>rootvg</td><td>usr</td><td>4 GB</td></tr><tr><td>/var</td><td>rootvg</td><td>var</td><td>1 GB</td></tr><tr><td>/home</td><td>rootvg</td><td>home</td><td>1 GB</td></tr></tbody></table><h3 id=è½¯ä»¶å®‰è£…>è½¯ä»¶å®‰è£…<a hidden class=anchor aria-hidden=true href=#è½¯ä»¶å®‰è£…>#</a></h3><ul><li><p>cloud-init</p></li><li><p>qemu-guest-agent (å¯é€‰)</p></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>dnf install -y cloud-init qemu-guest-agent
</span></span></code></pre></div><h3 id=cloud-inité…ç½®æ–‡ä»¶æ›´æ–°>cloud-inité…ç½®æ–‡ä»¶æ›´æ–°<a hidden class=anchor aria-hidden=true href=#cloud-inité…ç½®æ–‡ä»¶æ›´æ–°>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># æ›´æ–°çš„å†…å®¹</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>no_ssh_fingerprints</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>disable_root</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>ssh_pwauth</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>network</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w> </span><span class=l>disabled</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>datasource_list</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>OpenStack, ConfigDrive]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>datasource</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>OpenStack</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata_urls</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;http://169.254.169.254&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>max_wait</span><span class=p>:</span><span class=w> </span><span class=m>120</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># ç¤ºä¾‹</span>
</span></span><span class=line><span class=cl>sed -i <span class=s1>&#39;/# from the distro configuration/a\no_ssh_fingerprints: true&#39;</span> /etc/cloud/cloud.cfg
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sed -i <span class=s1>&#39;/disable_root: false/a\ssh_pwauth: 1&#39;</span> /etc/cloud/cloud.cfg
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s1>&#39;
</span></span></span><span class=line><span class=cl><span class=s1>network:
</span></span></span><span class=line><span class=cl><span class=s1>  config: disabled&#39;</span> &gt;&gt; /etc/cloud/cloud.cfg
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>datasource_list: [OpenStack, ConfigDrive]
</span></span></span><span class=line><span class=cl><span class=s2>datasource:
</span></span></span><span class=line><span class=cl><span class=s2>  OpenStack:
</span></span></span><span class=line><span class=cl><span class=s2>    metadata_urls: [&#39;http://169.254.169.254&#39;]
</span></span></span><span class=line><span class=cl><span class=s2>    max_wait: 120
</span></span></span><span class=line><span class=cl><span class=s2>    timeout: 5&#34;</span> &gt;&gt; /etc/cloud/cloud.cfg
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># å¼€æœºè‡ªå¯åŠ¨</span>
</span></span><span class=line><span class=cl>systemctl <span class=nb>enable</span> cloud-init-local.service cloud-init.service cloud-config.service cloud-final.service
</span></span></code></pre></div><h3 id=æ·»åŠ raidé©±åŠ¨>æ·»åŠ raidé©±åŠ¨<a hidden class=anchor aria-hidden=true href=#æ·»åŠ raidé©±åŠ¨>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat &gt; /etc/dracut.conf.d/raid_drives.conf <span class=s>&lt;&lt;EOF
</span></span></span><span class=line><span class=cl><span class=s>logfile=/var/log/dracut.log
</span></span></span><span class=line><span class=cl><span class=s>add_drivers+=&#34; ahci megaraid_sas mpt3sas mpt2sas &#34;
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>dracut -f -N
</span></span></code></pre></div><h2 id=userdataæ¨¡æ¿>UserDataæ¨¡æ¿<a hidden class=anchor aria-hidden=true href=#userdataæ¨¡æ¿>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=nv>node_bond0_macs</span><span class=o>=</span><span class=s2>&#34;08:30:ce:06:2b:cc 08:30:ce:06:33:aa&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>node_bond0_mode</span><span class=o>=</span><span class=s2>&#34;mode=active-backup,miimon=100&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>node_bond0_ip</span><span class=o>=</span><span class=s2>&#34;192.168.1.1&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>node_bond0_prefix</span><span class=o>=</span><span class=s2>&#34;24&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>node_bond0_netmask</span><span class=o>=</span><span class=s2>&#34;255.255.255.0&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>node_bond0_gw</span><span class=o>=</span><span class=s2>&#34;192.168.1.1&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>create_rootvg_partition<span class=o>(){</span>
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨xfsæ–‡ä»¶ç³»ç»Ÿ</span>
</span></span><span class=line><span class=cl>    <span class=nv>os_rootvg</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>lsblk -r <span class=p>|</span>grep -w <span class=s2>&#34;/&#34;</span> <span class=p>|</span>awk -F<span class=s1>&#39;-&#39;</span> <span class=s1>&#39;{print $1}&#39;</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[</span> x<span class=s2>&#34;</span><span class=si>${</span><span class=nv>os_rootvg</span><span class=si>}</span><span class=s2>&#34;</span> !<span class=o>=</span> x<span class=s2>&#34;&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nb>local</span> <span class=nv>parts</span><span class=o>=</span><span class=s1>&#39;
</span></span></span><span class=line><span class=cl><span class=s1>        resize|root|/|50G
</span></span></span><span class=line><span class=cl><span class=s1>        resize|user|/usr|50G
</span></span></span><span class=line><span class=cl><span class=s1>        resize|var|/var|50G
</span></span></span><span class=line><span class=cl><span class=s1>        resize|home|/home|50G
</span></span></span><span class=line><span class=cl><span class=s1>        create|swap|swap|8G
</span></span></span><span class=line><span class=cl><span class=s1>        create|tmp|/tmp|20G
</span></span></span><span class=line><span class=cl><span class=s1>        &#39;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> line in <span class=si>${</span><span class=nv>parts</span><span class=si>}</span><span class=p>;</span><span class=k>do</span>
</span></span><span class=line><span class=cl>            <span class=nb>local</span> <span class=nv>type</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span><span class=nb>echo</span> <span class=si>${</span><span class=nv>line</span><span class=si>}</span> <span class=p>|</span>awk -F<span class=s1>&#39;|&#39;</span> <span class=s1>&#39;{print $1}&#39;</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>            <span class=nb>local</span> <span class=nv>part_name</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span><span class=nb>echo</span> <span class=si>${</span><span class=nv>line</span><span class=si>}</span> <span class=p>|</span>awk -F<span class=s1>&#39;|&#39;</span> <span class=s1>&#39;{print $2}&#39;</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>            <span class=nb>local</span> <span class=nv>part_dir</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span><span class=nb>echo</span> <span class=si>${</span><span class=nv>line</span><span class=si>}</span> <span class=p>|</span>awk -F<span class=s1>&#39;|&#39;</span> <span class=s1>&#39;{print $3}&#39;</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>            <span class=nb>local</span> <span class=nv>part_size</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span><span class=nb>echo</span> <span class=si>${</span><span class=nv>line</span><span class=si>}</span> <span class=p>|</span>awk -F<span class=s1>&#39;|&#39;</span> <span class=s1>&#39;{print $4}&#39;</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=si>${</span><span class=nv>type</span><span class=si>}</span> in
</span></span><span class=line><span class=cl>                create<span class=o>)</span>
</span></span><span class=line><span class=cl>                    lvcreate -y -L <span class=si>${</span><span class=nv>part_size</span><span class=si>}</span> -n <span class=si>${</span><span class=nv>part_name</span><span class=si>}</span> <span class=si>${</span><span class=nv>os_rootvg</span><span class=si>}</span>
</span></span><span class=line><span class=cl>                    mkfs.xfs -f /dev/<span class=si>${</span><span class=nv>os_rootvg</span><span class=si>}</span>/<span class=si>${</span><span class=nv>part_name</span><span class=si>}</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=o>[</span> <span class=k>$(</span>grep <span class=s2>&#34;/dev/</span><span class=si>${</span><span class=nv>os_rootvg</span><span class=si>}</span><span class=s2>/</span><span class=si>${</span><span class=nv>part_name</span><span class=si>}</span><span class=s2>&#34;</span> /etc/fstab <span class=p>|</span>wc -l<span class=k>)</span> -eq <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>                        <span class=o>[</span> ! -d <span class=si>${</span><span class=nv>part_dir</span><span class=si>}</span> <span class=o>]</span> <span class=o>&amp;&amp;</span> mkdir -p <span class=si>${</span><span class=nv>part_dir</span><span class=si>}</span>
</span></span><span class=line><span class=cl>                        <span class=nb>echo</span> <span class=s2>&#34;/dev/</span><span class=si>${</span><span class=nv>os_rootvg</span><span class=si>}</span><span class=s2>/</span><span class=si>${</span><span class=nv>part_name</span><span class=si>}</span><span class=s2>  </span><span class=si>${</span><span class=nv>part_dir</span><span class=si>}</span><span class=s2>  xfs  defaults  0 0&#34;</span> &gt;&gt; /etc/fstab
</span></span><span class=line><span class=cl>                    <span class=k>fi</span>
</span></span><span class=line><span class=cl>                    <span class=p>;;</span>
</span></span><span class=line><span class=cl>                resize<span class=o>)</span>
</span></span><span class=line><span class=cl>                    lvextend -L <span class=si>${</span><span class=nv>part_size</span><span class=si>}</span> -n /dev/<span class=si>${</span><span class=nv>os_rootvg</span><span class=si>}</span>/<span class=si>${</span><span class=nv>part_name</span><span class=si>}</span>
</span></span><span class=line><span class=cl>                    xfs_growfs /dev/<span class=si>${</span><span class=nv>os_rootvg</span><span class=si>}</span>/<span class=si>${</span><span class=nv>part_name</span><span class=si>}</span>
</span></span><span class=line><span class=cl>                    <span class=c1># xfs_growfs ${part_dir}</span>
</span></span><span class=line><span class=cl>                    <span class=p>;;</span>
</span></span><span class=line><span class=cl>                *<span class=o>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>echo</span> <span class=s2>&#34;type error&#34;</span>
</span></span><span class=line><span class=cl>                    <span class=p>;;</span>
</span></span><span class=line><span class=cl>            <span class=k>esac</span>
</span></span><span class=line><span class=cl>        <span class=k>done</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;get rootvg info failed&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>create_users<span class=o>(){</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>users</span><span class=o>=</span><span class=s1>&#39;
</span></span></span><span class=line><span class=cl><span class=s1>    user:pass
</span></span></span><span class=line><span class=cl><span class=s1>    &#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> line in <span class=si>${</span><span class=nv>users</span><span class=si>}</span><span class=p>;</span><span class=k>do</span>
</span></span><span class=line><span class=cl>        <span class=nb>local</span> <span class=nv>name</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span><span class=nb>echo</span> <span class=si>${</span><span class=nv>line</span><span class=si>}</span> <span class=p>|</span>awk -F<span class=s1>&#39;:&#39;</span> <span class=s1>&#39;{print $1}&#39;</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        useradd -m <span class=si>${</span><span class=nv>name</span><span class=si>}</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>$line</span><span class=si>}</span><span class=s2>&#34;</span> <span class=p>|</span>chpasswd
</span></span><span class=line><span class=cl>    <span class=k>done</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>resize_os_partition<span class=o>(){</span>
</span></span><span class=line><span class=cl>    <span class=c1># è·å–å®‰è£…ç³»ç»Ÿçš„ç£ç›˜</span>
</span></span><span class=line><span class=cl>    <span class=nv>os_disk</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>lsblk -r <span class=p>|</span>grep -w <span class=s2>&#34;/boot&#34;</span> <span class=p>|</span>cut -c1-3<span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># è·å–/æ ¹æ–‡ä»¶ç³»ç»Ÿæ‰€åœ¨çš„vg</span>
</span></span><span class=line><span class=cl>    <span class=nv>os_rootvg</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>lsblk -r <span class=p>|</span>grep -w <span class=s2>&#34;/&#34;</span> <span class=p>|</span>awk -F<span class=s1>&#39;-&#39;</span> <span class=s1>&#39;{print $1}&#39;</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># è·å–/æ ¹æ–‡ä»¶ç³»ç»Ÿæ‰€åœ¨çš„ç›˜ç¬¦è·¯å¾„</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[</span> x<span class=s2>&#34;</span><span class=si>${</span><span class=nv>os_disk</span><span class=si>}</span><span class=s2>&#34;</span> !<span class=o>=</span> x<span class=s2>&#34;&#34;</span> <span class=o>]</span> <span class=o>&amp;&amp;</span> <span class=o>[</span> x<span class=s2>&#34;</span><span class=si>${</span><span class=nv>os_rootvg</span><span class=si>}</span><span class=s2>&#34;</span> !<span class=o>=</span> x<span class=s2>&#34;&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nv>os_rootvg_path</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>pvs <span class=p>|</span>grep -w <span class=s2>&#34;</span><span class=si>${</span><span class=nv>os_rootvg</span><span class=si>}</span><span class=s2>&#34;</span> <span class=p>|</span>egrep -o <span class=s2>&#34;/dev/</span><span class=si>${</span><span class=nv>os_disk</span><span class=si>}</span><span class=s2>[[:digit:]]+&#34;</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=nv>os_rootvg_path</span><span class=o>=</span><span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># è·å–/æ ¹æ–‡ä»¶ç³»ç»Ÿæ‰€åœ¨åˆ†åŒºå·</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[</span> x<span class=s2>&#34;</span><span class=si>${</span><span class=nv>os_rootvg_path</span><span class=si>}</span><span class=s2>&#34;</span> !<span class=o>=</span> x<span class=s2>&#34;&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nv>os_rootvg_path_num</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>lsblk -r <span class=p>|</span>grep -w <span class=s2>&#34;</span><span class=k>$(</span><span class=nb>echo</span> <span class=si>${</span><span class=nv>os_rootvg_path</span><span class=si>}</span> <span class=p>|</span>awk -F<span class=s1>&#39;/&#39;</span> <span class=s1>&#39;{print $NF}&#39;</span><span class=k>)</span><span class=s2>&#34;</span> <span class=p>|</span>awk <span class=s1>&#39;{print $2}&#39;</span> <span class=p>|</span>awk -F<span class=s1>&#39;:&#39;</span> <span class=s1>&#39;{print $NF}&#39;</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=nv>os_rootvg_path_num</span><span class=o>=</span><span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># resizeç³»ç»Ÿç›˜ï¼Œæ‰©å®¹è‡³100%</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[</span> x<span class=s2>&#34;</span><span class=si>${</span><span class=nv>os_disk</span><span class=si>}</span><span class=s2>&#34;</span> !<span class=o>=</span> x<span class=s2>&#34;&#34;</span> <span class=o>]</span> <span class=o>&amp;&amp;</span> <span class=o>[</span> x<span class=s2>&#34;</span><span class=si>${</span><span class=nv>os_rootvg_path</span><span class=si>}</span><span class=s2>&#34;</span> !<span class=o>=</span> x<span class=s2>&#34;&#34;</span> <span class=o>]</span> <span class=o>&amp;&amp;</span> <span class=o>[</span> x<span class=s2>&#34;</span><span class=si>${</span><span class=nv>os_rootvg_path_num</span><span class=si>}</span><span class=s2>&#34;</span> !<span class=o>=</span> x<span class=s2>&#34;&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        parted /dev/<span class=si>${</span><span class=nv>os_disk</span><span class=si>}</span> resizepart <span class=si>${</span><span class=nv>os_rootvg_path_num</span><span class=si>}</span> 100%
</span></span><span class=line><span class=cl>        pvresize <span class=si>${</span><span class=nv>os_rootvg_path</span><span class=si>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;resize root disk failed&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>net_setup_nmcli<span class=o>(){</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[</span> x<span class=s2>&#34;</span><span class=k>$(</span>systemctl is-enabled NetworkManager<span class=k>)</span><span class=s2>&#34;</span> !<span class=o>=</span> x<span class=s2>&#34;enabled&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        systemctl <span class=nb>enable</span> NetworkManager
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[</span> x<span class=s2>&#34;</span><span class=k>$(</span>systemctl is-active NetworkManager<span class=k>)</span><span class=s2>&#34;</span> !<span class=o>=</span> x<span class=s2>&#34;active&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        systemctl restart NetworkManager
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># åˆ é™¤ç°æœ‰ç½‘ç»œé…ç½®</span>
</span></span><span class=line><span class=cl>    nmcli connection delete <span class=k>$(</span>nmcli connection show <span class=p>|</span>awk <span class=s1>&#39;{print $(NF-2)}&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># æ ¹æ®MACéå†æ¥å£</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>ports</span><span class=o>=()</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> m in <span class=si>${</span><span class=nv>node_bond0_macs</span><span class=si>}</span><span class=p>;</span><span class=k>do</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> i in <span class=k>$(</span>nmcli device status <span class=p>|</span>grep ethernet <span class=p>|</span>awk <span class=s1>&#39;{print $1}&#39;</span><span class=k>)</span><span class=p>;</span><span class=k>do</span> 
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=o>[</span> <span class=k>$(</span>nmcli device show <span class=nv>$i</span> <span class=p>|</span>grep -i <span class=s2>&#34;</span><span class=si>${</span><span class=nv>m</span><span class=si>}</span><span class=s2>&#34;</span> <span class=p>|</span>wc -l<span class=k>)</span> -eq <span class=m>1</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>                <span class=nb>local</span> <span class=nv>n</span><span class=o>=</span><span class=si>${#</span><span class=nv>ports</span><span class=p>[@]</span><span class=si>}</span>
</span></span><span class=line><span class=cl>                ports<span class=o>[</span><span class=si>${</span><span class=nv>n</span><span class=si>}</span><span class=o>]=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>i</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>                <span class=nb>break</span>
</span></span><span class=line><span class=cl>            <span class=k>fi</span>
</span></span><span class=line><span class=cl>        <span class=k>done</span>
</span></span><span class=line><span class=cl>    <span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># åˆ›å»ºbond0æ¥å£</span>
</span></span><span class=line><span class=cl>    nmcli connection add <span class=nb>type</span> bond con-name bond0 ifname bond0 autoconnect yes bond.options <span class=s2>&#34;</span><span class=si>${</span><span class=nv>node_bond0_mode</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    nmcli connection modify bond0 ipv4.addresses <span class=si>${</span><span class=nv>node_bond0_ip</span><span class=si>}</span>/<span class=si>${</span><span class=nv>node_bond0_prefix</span><span class=si>}</span> ipv4.gateway <span class=si>${</span><span class=nv>node_bond0_gw</span><span class=si>}</span> ipv4.method manual
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># ç»‘å®šå­æ¥å£</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=o>((</span><span class=nv>i</span><span class=o>=</span>0<span class=p>;</span>i&lt;<span class=si>${#</span><span class=nv>ports</span><span class=p>[@]</span><span class=si>}</span><span class=p>;</span>i++<span class=o>))</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>        nmcli connection add <span class=nb>type</span> ethernet con-name <span class=si>${</span><span class=nv>ports</span><span class=p>[</span><span class=si>${</span><span class=nv>i</span><span class=si>}</span><span class=p>]</span><span class=si>}</span> ifname <span class=si>${</span><span class=nv>ports</span><span class=p>[</span><span class=si>${</span><span class=nv>i</span><span class=si>}</span><span class=p>]</span><span class=si>}</span> master bond0
</span></span><span class=line><span class=cl>    <span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># é‡è½½é…ç½®</span>
</span></span><span class=line><span class=cl>    nmcli connection reload
</span></span><span class=line><span class=cl>    nmcli connection down bond0 <span class=o>&amp;&amp;</span> nmcli connection up bond0
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>add_repos<span class=o>(){</span>
</span></span><span class=line><span class=cl>    <span class=c1># å¢åŠ è½¯ä»¶æºé…ç½®</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[</span> -d /etc/yum.repos.d <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        mkdir -p /etc/yum.repos.d/bak
</span></span><span class=line><span class=cl>        <span class=o>[</span> -d /etc/yum.repos.d/bak <span class=o>]</span> <span class=o>&amp;&amp;</span> mv /etc/yum.repos.d/*.repo /etc/yum.repos.d/bak/
</span></span><span class=line><span class=cl>        cat &gt; /etc/yum.repos.d/base.repo <span class=s>&lt;&lt;EOF
</span></span></span><span class=line><span class=cl><span class=s>[os_base]
</span></span></span><span class=line><span class=cl><span class=s>name=base packages
</span></span></span><span class=line><span class=cl><span class=s>baseurl=http://172.16.1.1:8080/anolis/BaseOS
</span></span></span><span class=line><span class=cl><span class=s>enabled=1
</span></span></span><span class=line><span class=cl><span class=s>gpgcheck=0
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>[os_stream]
</span></span></span><span class=line><span class=cl><span class=s>name=stream packages
</span></span></span><span class=line><span class=cl><span class=s>baseurl=http://172.16.1.1:8080/anolis/AppStream
</span></span></span><span class=line><span class=cl><span class=s>enabled=1
</span></span></span><span class=line><span class=cl><span class=s>gpgcheck=0
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>main<span class=o>(){</span>
</span></span><span class=line><span class=cl>    <span class=c1># ç³»ç»Ÿç£ç›˜åˆ†åŒºæ‰©å®¹</span>
</span></span><span class=line><span class=cl>    resize_os_partition
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># ç³»ç»Ÿåˆ†åŒºæ‰©å®¹</span>
</span></span><span class=line><span class=cl>    create_rootvg_partition
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># é…ç½®bondå’Œip</span>
</span></span><span class=line><span class=cl>    net_setup_nmcli
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># åˆ›å»ºè´¦å·å¯†ç </span>
</span></span><span class=line><span class=cl>    create_users
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># é…ç½®è½¯ä»¶æº</span>
</span></span><span class=line><span class=cl>    add_repos
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># åœç”¨cloud-init</span>
</span></span><span class=line><span class=cl>    systemctl disable cloud-init-local.service cloud-init.service cloud-config.service cloud-final.service
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    reboot
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>main
</span></span></code></pre></div><h2 id=ironic-nodeæ¨é€ç¤ºä¾‹>ironic nodeæ¨é€ç¤ºä¾‹<a hidden class=anchor aria-hidden=true href=#ironic-nodeæ¨é€ç¤ºä¾‹>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># ç¤ºä¾‹</span>
</span></span><span class=line><span class=cl>nova boot --config-drive <span class=nb>true</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--user-data <span class=si>${</span><span class=nv>userdata_file</span><span class=si>}</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--flavor <span class=si>${</span><span class=nv>flavor_id</span><span class=si>}</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--image <span class=si>${</span><span class=nv>image_name</span><span class=si>}</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--nic net-name<span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>network_name</span><span class=si>}</span><span class=s2>&#34;</span>,v4-fixed-ip<span class=o>=</span><span class=si>${</span><span class=nv>instance_ip</span><span class=si>}</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--availability-zone nova::<span class=si>${</span><span class=nv>ironic_node_uuid</span><span class=si>}</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=si>${</span><span class=nv>instance_name</span><span class=si>}</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://gnail89.github.io/tags/ironic/>Ironic</a></li></ul><nav class=paginav><a class=prev href=https://gnail89.github.io/posts/setup-openstackclient-3.12.2-by-pip/><span class=title>Â« Prev</span><br><span>Setup Openstackclient 3.12.2 by pip</span>
</a><a class=next href=https://gnail89.github.io/posts/kubernetes-v1.27.6-centos8stream-binary-install/><span class=title>Next Â»</span><br><span>Kubernetes V1.27.6 Centos8stream Binary Install</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://gnail89.github.io/>ğŸ“•W.'s Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>